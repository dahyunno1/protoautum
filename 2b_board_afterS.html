<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.11.0/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.11.0/addons/p5.sound.min.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
    <meta charset="utf-8" />
    <style>
        /* @import 구문을 style 태그의 가장 위에 배치 */
        @import url('https://fastly.jsdelivr.net/npm/galmuri@latest/dist/galmuri.css');

        body {
            font-family: 'galmuri11', sans-serif; /* 기본 폰트 설정 */
        }

        .introtext {
            position: fixed; /* 화면에 고정 */
            top: 50%; /* 세로 중앙 */
            left: 50%; /* 가로 중앙 */
            transform: translate(-50%, -50%); /* 정확히 중앙 정렬 */
            background-color: #c9e8ff; /* 노란색 배경 */
            border: 5px solid #000;
            color: #000; /* 검은색 텍스트 */
            font-family: 'galmuri11', sans-serif; /* 텍스트 박스 폰트 */
            padding: 50px 60px; /* 내부 여백 */
            border-radius: 20px; /* 둥근 모서리 */
            font-size: 70px; /* 텍스트 크기 */
            line-height: 1.8; /* 줄 간격 조정 */
            text-align: center; /* 텍스트 중앙 정렬 */
            z-index: 1000; /* 콘텐츠 위로 뜨게 */
            display: none;
        }

        .introtext button {
            margin-top: 10px;
            padding: 10px 20px;
            background-color: #ffdf00;
            color: #000;
            border: 3px solid #000;
            border-radius: 5px;
            cursor: pointer;
            font-size: 40px;
            font-family: 'galmuri11', sans-serif;
        }

        .introtext button:hover {
            background-color: #333;
        }

        .first-text {
            position: fixed;
            bottom: 10%; /* 화면 하단 10% */
            left: 50%; /* 가로 중앙 */
            transform: translateX(-50%); /* 정확히 중앙 정렬 */
            background-color: #ffdf00;
            color: #000;
            padding: 30px 50px;
            border-radius: 20px;
            font-size: 50px;
            text-align: left;
            display: none; /* 처음에는 숨김 */
        }
        
    </style>
</head>
<body>
    <main>
    </main>
    <div class="introtext" id="textBox">
        경기도 한 지역에서 살고 있는 홍익이는
        <br>통학을 하고 있는 홍익대학교 시각디자인과 학생입니다.
        <br>홍익이는 왕복 4시간의 통학으로 인해, 안타깝게도
        <br>남들보다는 조금 더 피곤하게 하루를 시작하곤 합니다.
        <br> 오늘도 어김없이 등교를 하는 통학러 홍익이의 하루를 함께 보내볼까요?
        <br>* 홍익이는 방향키(⇦⇧⇨⇩)로 움직일 수 있습니다 *
        <button onclick="closeBox()">Let's Go!</button>
    </div>

    <div class="first-text" id="firsttextBox">
        오늘 운이 좀 좋은데? 앉아서 학교에 오니 피로감이 확실히 덜하군.
        <br>이제 수업을 들으러 가자. 첫 수업은 홍문관에 있어. 홍문관에 가줘!
    </div>
 
    <div class="introtext" id="finishTextBox">
        Finish!
    </div>
    
    <script>
        var x = 170;
        var y = 1000;

        let playerImg;
        let backgroundImg;
        let targets = []; // 타겟들을 배열로 관리
        let playerWidth = 300;
        let playerHeight = 300;

        let isColliding = false; // 충돌 발생 여부 플래그
        let fadeAmount = 0; // 페이드 아웃 효과를 위한 변수
        let fadeInAmount = 255; // 초기 페이드인 효과를 위한 변수 (처음에 완전히 어두운 상태)

        function preload() {
            playerImg = loadImage('player_front.png', img => {
                let aspectRatio = img.height / img.width;
                playerWidth = 300;
                playerHeight = playerWidth * aspectRatio;
            });
            backgroundImg = loadImage('board.png'); // 배경 이미지 파일
        }

        function setup() {
            createCanvas(5120, 2880);

            // 타겟 위치 및 크기 배열 설정
            targets.push({ img: loadImage('board_1.png'), x: 170, y: 1000, w: 800, h: 800, page: '3_subway.html' });
            targets.push({ img: loadImage('board_2.png'), x: 1150, y: 700, w: 800, h: 800, page: '4_class.html' });
            targets.push({ img: loadImage('board_3.png'), x: 2200, y: 950, w: 800, h: 800, page: '5_jumpgame.html' });
            targets.push({ img: loadImage('board_4.png'), x: 3200, y: 1150, w: 800, h: 800, page: '6_buying.html' });
            targets.push({ img: loadImage('board_5.png'), x: 4200, y: 1000, w: 800, h: 800, page: '7_home.html' });

            setTimeout(() => {
                const textBox = document.getElementById('textBox');
                textBox.style.display = 'block'; // 텍스트 박스 보이기
            }, 2000); // 페이드인 완료 시간 (3000ms)
        }

        function closeBox() {
            const textBox = document.getElementById('textBox');
            textBox.style.display = 'none'; // 텍스트 박스 숨기기

            // 두 번째 텍스트 박스 보이기
            const firsttextBox = document.getElementById('firsttextBox');
            firsttextBox.style.display = 'block';
        }

        function draw() {
            // 배경 이미지 렌더링
            background(backgroundImg);

            // 타겟 이미지 그리기 및 충돌 감지 범위 계산
            for (let i = 0; i < targets.length; i++) {
                let target = targets[i];
                let aspectRatio = target.img.width / target.img.height;

                // 타겟의 너비와 높이에 따라 비율 유지 크기 계산
                let imgWidth = target.w;
                let imgHeight = target.w / aspectRatio;

                // 이미지가 타겟의 높이를 초과하면 높이를 기준으로 조정
                if (imgHeight > target.h) {
                    imgHeight = target.h;
                    imgWidth = target.h * aspectRatio;
                }

                // 타겟 중심에 이미지 배치
                let imgX = target.x + (target.w - imgWidth) / 2;
                let imgY = target.y + (target.h - imgHeight) / 2;

                // 타겟 이미지 그리기
                image(target.img, imgX, imgY, imgWidth, imgHeight);

                // 충돌 감지
                if (checkCollision(x, y, imgX, imgY, playerWidth, playerHeight, imgWidth, imgHeight)) {
                    console.log("Collision detected with " + target.page);
                    isColliding = true;

                    // 충돌 시 페이드 아웃 효과 시작
                    if (fadeAmount < 255) {
                        fadeAmount += 4; // 천천히 페이드 아웃
                    }

                    // 페이드 아웃이 완료되면 페이지 이동
                    if (fadeAmount >= 255) {
                        window.location.href = target.page;
                    }
                    break;
                }
            }

            // 플레이어 이미지 그리기
            image(playerImg, x, y, playerWidth, playerHeight);

            // 페이드인 효과
            if (fadeInAmount > 0) {
                fadeInAmount -= 5;
                fill(0, fadeInAmount);
                rect(0, 0, width, height);
            }

            // 충돌 발생 시 페이드아웃 효과
            if (isColliding) {
                fadeScreen();
                return;
            }
        }

        // 페이드 아웃 화면
        function fadeScreen() {
            fill(0, fadeAmount);
            rect(0, 0, width, height);
        }

        function keyPressed() {
            // 충돌이 발생하지 않은 경우에만 플레이어 이동
            if (!isColliding) {
                if (keyCode === UP_ARROW) {
                    y = y - 70;
                } else if (keyCode === DOWN_ARROW) {
                    y = y + 70;
                }
                if (keyCode === LEFT_ARROW) {
                    x = x - 70;
                } else if (keyCode === RIGHT_ARROW) {
                    x = x + 70;
                }
            }
        }

        // 충돌 감지 함수
        function checkCollision(x1, y1, x2, y2, width1, height1, width2, height2) {
            return (
                x1 < x2 + width2 &&       // 오른쪽 경계선
                x1 + width1 > x2 &&       // 왼쪽 경계선
                y1 < y2 + height2 &&      // 아래쪽 경계선
                y1 + height1 > y2        // 위쪽 경계선
            );
        }
    </script>
</body>
</html>
